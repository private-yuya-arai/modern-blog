const r=`---\r
slug: "hypothesis-testing-chapter5"\r
title: "仮説検定の選び方ガイド：p値と有意水準の正しい理解"\r
date: "2025-10-19"\r
category: "統計学"\r
tags: ["統計検定準一級", "Python", "R", "仮説検定", "t検定", "第一種の過誤"]\r
excerpt: "「有意差あり」とはどういうことか？背理法のようなロジック「仮説検定」の仕組みと、Z検定・t検定・カイ二乗検定の使い分けをチャートで整理します。"\r
image: "/images/hypothesis.png"\r
---\r
\r
## この知識はいつ使うの？\r
\r
*   **A/Bテストの判定**: 新しいWebデザインの方が、古い方よりも「明らかに（有意に）」クリック率が高いかを判定したいとき。\r
*   **新薬の効果測定**: 薬を飲んだグループと飲まないグループで、治癒率に「偶然ではない差」があるか確かめたいとき。\r
*   **品質管理**: 製品のサイズが規定値からズレていないかチェックしたいとき。\r
\r
## 仮説検定のロジック（背理法）\r
\r
仮説検定は、少しひねくれた考え方をします。「差があること」を示したいのに、あえて「差がない」と仮定して矛盾を導きます。\r
\r
\`\`\`mermaid\r
graph TD\r
    Step1["1. 帰無仮説 H0を立てる<br>「差はない（偶然だ）」"] --> Step2["2. データを取る"]\r
    Step2 --> Step3["3. p値を計算する<br>「もしH0が正しかったら、<br>こんなデータが出る確率は？」"]\r
    Step3 --> Step4{"p値 ＜ 0.05 ?"}\r
    Step4 -- Yes --> Reject["H0を棄却<br>「めったにない事が起きた。<br>前提(H0)がおかしい！」<br>→ 差はある(H1)"]\r
    Step4 -- No --> CantReject["H0を棄却できない<br>「偶然でもありえる範囲だ」<br>→ 結論保留"]\r
\`\`\`\r
\r
**p値 (p-value)**: 「偶然だけでこんな差が出る確率」。これが5%(0.05)より小さければ、「偶然にしては出来すぎている $\\rightarrow$ 何か理由（有意差）があるはずだ」と判断します。\r
\r
## 検定選びのフローチャート\r
\r
「何を調べたいか」によって使う検定（検定統計量）が変わります。ここが一番迷うポイントです。\r
\r
\`\`\`mermaid\r
graph TD\r
    Start{"データの種類は？"}\r
    \r
    Start -->|平均値の差| Mean{"比較対象は？"}\r
    Mean -->|対象値 vs データ| T1["1標本t検定"]\r
    Mean -->|A群 vs B群| T2{"対応はある？"}\r
    T2 -->|Yes (Before/After)| TPair["対応のあるt検定"]\r
    T2 -->|No (別々の人)| TInd["独立2標本t検定"]\r
    \r
    Start -->|比率・割合| Prop["カイ二乗検定 / Z検定"]\r
    \r
    Start -->|分散(ばらつき)| Var["F検定 / カイ二乗検定"]\r
\`\`\`\r
\r
## エラーの種類（タイプ1 vs タイプ2）\r
\r
検定には2種類の「間違い」があります。裁判に例えるとわかりやすいです。\r
\r
| エラー | 別名 | 説明 | 例え（冤罪か見逃しか） |\r
| :--- | :--- | :--- | :--- |\r
| **第一種の過誤** ($\\alpha$) | 偽陽性 | 本当は差がないのに「ある」と言ってしまう | **冤罪**: 無実の人を犯人とする（深刻！） |\r
| **第二種の過誤** ($\\beta$) | 偽陰性 | 本当は差があるのに「ない（見つけられない）」と言う | **見逃し**: 犯人を無罪放免する（証拠不十分） |\r
\r
統計学では、まず「冤罪（第一種の過誤）」を5%以下に抑えることを最優先します（有意水準 $\\alpha = 0.05$）。\r
\r
## Pythonでの実装：独立2標本のt検定\r
\r
「クラスAとクラスBのテストの平均点に差があるか？」を検定します。\r
\r
\`\`\`python\r
import numpy as np\r
from scipy import stats\r
\r
# データ生成\r
np.random.seed(42)\r
class_A = np.random.normal(70, 10, 30) # 平均70点\r
class_B = np.random.normal(75, 10, 30) # 平均75点（実は差がある）\r
\r
# t検定 (独立2標本、等分散を仮定しないウェルチの検定)\r
t_stat, p_val = stats.ttest_ind(class_A, class_B, equal_var=False)\r
\r
print(f"t統計量: {t_stat:.3f}")\r
print(f"p値: {p_val:.4f}")\r
\r
if p_val < 0.05:\r
    print("判定: 有意差あり (H0を棄却)")\r
else:\r
    print("判定: 有意差なし (H0を棄却できない)")\r
\`\`\`\r
\r
## Rでの実装：カイ二乗検定（独立性の検定）\r
\r
「喫煙習慣」と「肺がん」に関連があるか？クロス集計表から検定します。\r
\r
\`\`\`r\r
# クロス集計表の作成 (行: 喫煙/非喫煙, 列: がん/健康)\r
data <- matrix(c(40, 10,  # 喫煙群: がん40人, 健康10人\r
                 20, 80), # 非喫煙群: がん20人, 健康80人\r
               nrow=2, byrow=TRUE)\r
\r
colnames(data) <- c("Cancer", "Healthy")\r
rownames(data) <- c("Smoker", "Non-Smoker")\r
\r
# カイ二乗検定\r
result <- chisq.test(data)\r
\r
print(result)\r
# p-value < 2.2e-16 となり、非常に強い関連（有意差）が示されるはず\r
\`\`\`\r
\r
## まとめ\r
\r
*   **p値 < 0.05** なら「偶然とは考えにくい」→ **有意差あり**。\r
*   平均の比較なら標準的には **t検定** を使う。\r
*   比率の比較やクロス集計なら **カイ二乗検定** を使う。\r
*   「有意差なし」は「同じである」という証明ではない（単にデータ不足かも）点に注意。\r
`;export{r as default};
